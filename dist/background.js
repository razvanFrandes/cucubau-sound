let o={isRecording:!1,startTime:null,tabId:null,tabTitle:""};async function a(){return(await chrome.storage.local.get("recordings")).recordings||[]}async function n(e){const r=await a(),t={...e,folderId:e.folderId||"uncategorized"};r.push(t),await chrome.storage.local.set({recordings:r})}function i(){chrome.runtime.sendMessage({type:"STATE_UPDATE",state:o}).catch(()=>{})}chrome.runtime.onMessage.addListener((e,r,t)=>{if(e.type==="SET_RECORDING_STATE")o=e.state,i(),t({success:!0});else if(e.type==="GET_STATE")t({state:o});else{if(e.type==="SAVE_RECORDING")return n(e.recording).then(()=>{chrome.runtime.sendMessage({type:"RECORDING_SAVED",recording:e.recording}).catch(()=>{}),t({success:!0})}),!0;if(e.type==="DOWNLOAD_FILE")return chrome.downloads.download({url:e.url,filename:e.filename,saveAs:!1}).then(c=>{t({success:!0,downloadId:c})}).catch(c=>{t({success:!1,error:c.message})}),!0}return!0});chrome.storage.local.get("recordingState").then(e=>{e.recordingState?.isRecording&&chrome.storage.local.remove("recordingState")});
