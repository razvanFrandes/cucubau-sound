let o={isRecording:!1,startTime:null,tabId:null,tabTitle:""};async function a(){return(await chrome.storage.local.get("recordings")).recordings||[]}async function i(e){const c=await a(),r={...e,folderId:e.folderId||"uncategorized"};c.push(r),await chrome.storage.local.set({recordings:c})}function n(){chrome.runtime.sendMessage({type:"STATE_UPDATE",state:o}).catch(()=>{})}chrome.runtime.onMessage.addListener((e,c,r)=>{if(e.type==="SET_RECORDING_STATE")o=e.state,n(),r({success:!0});else if(e.type==="GET_STATE")r({state:o});else{if(e.type==="SAVE_RECORDING")return i(e.recording).then(()=>{chrome.runtime.sendMessage({type:"RECORDING_SAVED",recording:e.recording}).catch(()=>{}),r({success:!0})}),!0;if(e.type==="DOWNLOAD_FILE")return chrome.downloads.download({url:e.url,filename:e.filename,saveAs:!1}).then(t=>{t&&chrome.downloads.erase({id:t}),r({success:!0,downloadId:t})}).catch(t=>{r({success:!1,error:t.message})}),!0}return!0});chrome.storage.local.get("recordingState").then(e=>{e.recordingState?.isRecording&&chrome.storage.local.remove("recordingState")});
